<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Scratch Inc. - Roguelike</title>
    <style>
        :root {
            --bg-deep: #0f172a;
            --bg-slate: #1e293b;
            --accent-blue: #38bdf8;
            --accent-green: #22c55e;
            --text-gold: #f1c40f;
            --card-white: #f8fafc;
        }

        body { 
            font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            background: radial-gradient(circle at top, var(--bg-slate), var(--bg-deep));
            color: white; margin: 0; padding: 20px 0;
            display: flex; flex-direction: column; align-items: center; 
            min-height: 100vh; touch-action: pan-y;
        }

        .header {
            width: 100%; max-width: 400px;
            display: flex; justify-content: space-between; align-items: center;
            padding: 0 20px; margin-bottom: 20px; box-sizing: border-box;
        }

        .stats-badge {
            background: rgba(255, 255, 255, 0.1); padding: 8px 16px;
            border-radius: 20px; border: 1px solid rgba(255, 255, 255, 0.2);
            font-weight: bold; color: var(--text-gold); font-size: 1.2rem;
        }

        /* NEW: Ticket Tabs UI */
        .ticket-menu {
            display: flex; gap: 8px; margin-bottom: 15px; width: 320px;
        }
        .ticket-tab {
            flex: 1; padding: 10px 5px; border-radius: 12px; background: #334155;
            border: 2px solid transparent; cursor: pointer; text-align: center;
            font-size: 0.75rem; font-weight: bold; color: #94a3b8; transition: 0.2s;
        }
        .ticket-tab.active { border-color: var(--accent-blue); background: #1e293b; color: var(--accent-blue); }

        .card-container {
            position: relative; width: 320px; height: 320px;
            background: var(--card-white); border-radius: 24px; 
            overflow: hidden; border: 6px solid #334155;
            box-shadow: 0 20px 50px rgba(0,0,0,0.5);
        }

        .prize-grid {
            display: grid; width: 100%; height: 100%; position: absolute;
            grid-template-columns: repeat(2, 1fr); /* Defaults to 2x2 */
        }

        .prize-cell {
            display: flex; align-items: center; justify-content: center;
            font-size: 2.5rem; border: 1px solid #e2e8f0; color: #334155;
        }

        canvas { position: absolute; top: 0; left: 0; cursor: crosshair; z-index: 10; touch-action: none; }
        #particle-canvas { pointer-events: none; z-index: 20; }

        .btn-primary { 
            background: var(--accent-green); color: white; border: none; 
            padding: 16px; width: 320px; border-radius: 16px; cursor: pointer; 
            font-weight: bold; font-size: 1.1rem; margin-top: 20px;
            box-shadow: 0 4px 0 #15803d; transition: all 0.1s;
        }
        .btn-primary:active { transform: translateY(2px); box-shadow: 0 2px 0 #15803d; }
        .btn-primary:disabled { background: #475569; box-shadow: 0 4px 0 #334155; opacity: 0.6; }

        .shop-container {
            width: 320px; background: rgba(30, 41, 59, 0.7);
            backdrop-filter: blur(10px); border-radius: 24px;
            padding: 20px; margin-top: 30px; border: 1px solid rgba(255, 255, 255, 0.1);
            box-sizing: border-box;
        }
        .shop-header { color: var(--accent-blue); margin: 0 0 15px 0; font-size: 1rem; text-transform: uppercase; letter-spacing: 1px; }
        .upgrade-row { display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px; }
        .upgrade-info p { margin: 0; font-size: 0.85rem; color: #94a3b8; }
        .btn-upgrade { background: var(--accent-blue); color: #0f172a; border: none; padding: 8px 12px; border-radius: 10px; font-weight: bold; cursor: pointer; min-width: 80px; }
        .btn-upgrade:disabled { background: #475569; color: #94a3b8; }

        .modal {
            display: none; position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%);
            background: white; color: #0f172a; padding: 30px; border-radius: 24px; 
            z-index: 100; text-align: center; width: 260px; box-shadow: 0 0 100px rgba(0,0,0,0.8);
        }
        .win-amount { color: var(--accent-green); font-weight: bold; font-size: 1.4rem; display: block; margin-top: 5px; }
    </style>
</head>
<body>

    <div class="header">
        <div style="font-weight: bold; font-size: 1.4rem;">Scratch Inc.</div>
        <div class="stats-badge">ðŸ’° <span id="coin-count">--</span></div>
    </div>

    <div class="ticket-menu">
        <div class="ticket-tab active" onclick="selectTicket('mini', this)">MINI (2ðŸ’°)</div>
        <div class="ticket-tab" onclick="selectTicket('mega', this)">MEGA (10ðŸ’°)</div>
        <div class="ticket-tab" onclick="selectTicket('ultra', this)">ULTRA (50ðŸ’°)</div>
    </div>

    <div class="card-container">
        <div class="prize-grid" id="prize-grid">
            <div class="prize-cell">?</div><div class="prize-cell">?</div>
            <div class="prize-cell">?</div><div class="prize-cell">?</div>
        </div>
        <canvas id="scratch-canvas" width="320" height="320"></canvas>
        <canvas id="particle-canvas" width="320" height="320"></canvas>
    </div>

    <button id="buy-btn" class="btn-primary" onclick="buyCard()">BUY CARD (2 ðŸ’°)</button>

    <div class="shop-container">
        <h3 class="shop-header">Gear & Upgrades</h3>
        <div class="upgrade-row">
            <div class="upgrade-info"><b>Coin Size</b><p>Level <span id="size-lvl">1</span></p></div>
            <button id="up-size" class="btn-upgrade" onclick="upgrade('size')">--</button>
        </div>
        <div class="upgrade-row" style="margin-bottom: 0;">
            <div class="upgrade-info"><b>Scratch Power</b><p>Level <span id="str-lvl">1</span></p></div>
            <button id="up-str" class="btn-upgrade" onclick="upgrade('strength')">--</button>
        </div>
    </div>

    <div id="result-modal" class="modal">
        <h2 id="modal-title">TITLE</h2>
        <p id="modal-msg">MESSAGE</p>
        <button class="btn-primary" style="width: 100%; margin-top: 20px;" onclick="closeModal()">COLLECT</button>
    </div>

<script>
    // --- TICKET DATA ---
    const TICKET_TYPES = {
        mini:  { cost: 2,  cols: 2, rows: 2, win3: 20, win2: 5,  pair2: 15 },
        mega:  { cost: 10, cols: 3, rows: 3, win3: 100, win2: 20, pair2: 50 },
        ultra: { cost: 50, cols: 4, rows: 4, win3: 500, win2: 100, pair2: 250 }
    };

    let currentType = 'mini';
    let coins = parseInt(localStorage.getItem('scratcher_coins')) || 10;
    let sizeLvl = parseInt(localStorage.getItem('size_lvl')) || 1;
    let strLvl = parseInt(localStorage.getItem('str_lvl')) || 1;
    
    const symbols = ['ðŸ’', 'ðŸ’Ž', 'ðŸ‹', 'â­', 'ðŸ””'];
    const canvas = document.getElementById('scratch-canvas');
    const ctx = canvas.getContext('2d');
    const pCanvas = document.getElementById('particle-canvas');
    const pCtx = pCanvas.getContext('2d');
    
    let isDrawing = false, lastX = 0, lastY = 0, cardActive = false, pendingWin = 0, particles = [];

    updateUI();
    handleRecharge(); //
    animateParticles();

    function selectTicket(type, el) {
        if (cardActive) return;
        currentType = type;
        const ticket = TICKET_TYPES[type];
        
        document.querySelectorAll('.ticket-tab').forEach(t => t.classList.remove('active'));
        el.classList.add('active');
        document.getElementById('buy-btn').innerText = `BUY ${type.toUpperCase()} (${ticket.cost} ðŸ’°)`;

        // Update Grid
        const grid = document.getElementById('prize-grid');
        grid.style.gridTemplateColumns = `repeat(${ticket.cols}, 1fr)`;
        grid.innerHTML = '';
        for(let i=0; i < (ticket.cols * ticket.rows); i++) {
            const cell = document.createElement('div');
            cell.className = 'prize-cell';
            cell.innerText = '?';
            grid.appendChild(cell);
        }
    }

    function updateUI() {
        document.getElementById('coin-count').innerText = coins;
        document.getElementById('size-lvl').innerText = sizeLvl;
        document.getElementById('str-lvl').innerText = strLvl;
        const sCost = sizeLvl * 50, stCost = strLvl * 75;
        document.getElementById('up-size').innerText = `${sCost} ðŸ’°`;
        document.getElementById('up-str').innerText = `${stCost} ðŸ’°`;
        document.getElementById('up-size').disabled = coins < sCost;
        document.getElementById('up-str').disabled = coins < stCost;
        localStorage.setItem('scratcher_coins', coins);
        localStorage.setItem('size_lvl', sizeLvl);
        localStorage.setItem('str_lvl', strLvl);
    }

    function buyCard() {
        const ticket = TICKET_TYPES[currentType];
        if (coins < ticket.cost) return alert("Not enough coins!");
        coins -= ticket.cost;
        updateUI();
        
        canvas.style.transition = "none"; canvas.style.opacity = "1";
        ctx.globalCompositeOperation = 'source-over';
        ctx.fillStyle = '#cbd5e1'; ctx.fillRect(0, 0, 320, 320);
        ctx.fillStyle = '#94a3b8'; for(let i=0; i<800; i++) ctx.fillRect(Math.random()*320, Math.random()*320, 1.5, 1.5);

        const res = [];
        document.querySelectorAll('.prize-cell').forEach(c => {
            const s = symbols[Math.floor(Math.random() * symbols.length)];
            c.innerText = s; res.push(s);
        });

        // TWO PAIR & MATCH LOGIC
        const counts = {}; res.forEach(s => counts[s] = (counts[s] || 0) + 1);
        const valCounts = Object.values(counts);
        const maxMatch = Math.max(...valCounts);
        const numPairs = valCounts.filter(v => v === 2).length;

        if (maxMatch >= 3) {
            pendingWin = ticket.win3;
            document.getElementById('modal-title').innerText = "WINNER!";
        } else if (numPairs >= 2) { // THE TWO PAIR COMBO
            pendingWin = ticket.pair2;
            document.getElementById('modal-title').innerText = "COMBO WIN!";
        } else if (maxMatch === 2) {
            pendingWin = ticket.win2;
            document.getElementById('modal-title').innerText = "WINNER!";
        } else {
            pendingWin = 0;
            document.getElementById('modal-title').innerText = "TRY AGAIN";
        }
        
        document.getElementById('modal-msg').innerHTML = pendingWin > 0 ? `Matched Symbols!<br><span class="win-amount">+${pendingWin} ðŸ’°</span>` : "No matches this time.";
        cardActive = true; document.getElementById('buy-btn').disabled = true;
    }

    // --- RECHARGE LOGIC ---
    function handleRecharge() {
        const now = Date.now(), last = parseInt(localStorage.getItem('last_login_time')) || now;
        const blocks = Math.floor(((now - last) / (1000 * 60 * 60)) / 4);
        if (blocks > 0) {
            const bonus = Math.min(blocks * 4, 12);
            coins += bonus;
            alert(`Claimed ${bonus} ðŸ’° from time rewards!`);
            localStorage.setItem('last_login_time', now.toString());
            updateUI();
        }
    }

    // --- SCRATCH & PARTICLES (Preserved from original) ---
    function scratch(e) {
        if (!isDrawing || !cardActive) return;
        const rect = canvas.getBoundingClientRect();
        const x = (e.touches ? e.touches[0].clientX : e.clientX) - rect.left;
        const y = (e.touches ? e.touches[0].clientY : e.clientY) - rect.top;
        ctx.globalCompositeOperation = 'destination-out';
        const rad = 10 + (sizeLvl * 2);
        ctx.lineWidth = rad; ctx.lineJoin = "round"; ctx.lineCap = "round";
        for(let i=0; i < 5+strLvl; i++) {
            const ox = (Math.random()-0.5)*rad, oy = (Math.random()-0.5)*rad;
            ctx.beginPath(); ctx.moveTo(lastX+ox, lastY+oy); ctx.lineTo(x+ox, y+oy); ctx.stroke();
        }
        lastX = x; lastY = y; createParticles(x, y);
        if (Math.random() > 0.98) checkReveal();
    }

    function checkReveal() {
        const data = ctx.getImageData(0,0,320,320).data;
        let trans = 0; for(let i=3; i<data.length; i+=4) if(data[i] === 0) trans++;
        if ((trans / (320*320)) > (0.60 - (strLvl * 0.01))) {
            cardActive = false; canvas.style.transition = "opacity 1.2s"; canvas.style.opacity = "0";
            setTimeout(() => { coins += pendingWin; updateUI(); document.getElementById('result-modal').style.display = 'block'; }, 1200);
        }
    }

    function closeModal() {
        document.getElementById('result-modal').style.display = 'none';
        document.getElementById('buy-btn').disabled = false;
        document.querySelectorAll('.prize-cell').forEach(c => c.innerText = "?");
        ctx.clearRect(0,0,320,320);
        localStorage.setItem('last_login_time', Date.now().toString());
    }

    function upgrade(type) {
        const cost = type === 'size' ? sizeLvl * 50 : strLvl * 75;
        if (coins >= cost) {
            coins -= cost;
            if (type === 'size') sizeLvl++; else strLvl++;
            updateUI();
        }
    }

    function startDrawing(e) {
        isDrawing = true; const rect = canvas.getBoundingClientRect();
        lastX = (e.touches ? e.touches[0].clientX : e.clientX) - rect.left;
        lastY = (e.touches ? e.touches[0].clientY : e.clientY) - rect.top;
        scratch(e);
    }

    function createParticles(x, y) {
        for(let i=0; i < (2 * strLvl); i++) particles.push({ x: x+(Math.random()-0.5)*10, y: y+(Math.random()-0.5)*10, vx: (Math.random()-0.5)*2, vy: Math.random()*3, life: 30, size: 1+Math.random()*2 });
    }

    function animateParticles() {
        pCtx.clearRect(0, 0, 320, 320);
        particles.forEach((p, i) => {
            p.x += p.vx; p.y += p.vy; p.life--;
            pCtx.fillStyle = `rgba(140, 140, 140, ${p.life/30})`; pCtx.fillRect(p.x, p.y, p.size, p.size);
            if(p.life <= 0) particles.splice(i, 1);
        });
        requestAnimationFrame(animateParticles);
    }

    canvas.addEventListener('mousedown', startDrawing);
    window.addEventListener('mouseup', () => isDrawing = false);
    canvas.addEventListener('mousemove', scratch);
    canvas.addEventListener('touchstart', (e) => { startDrawing(e); }, {passive: false});
    canvas.addEventListener('touchend', () => isDrawing = false);
    canvas.addEventListener('touchmove', (e) => { scratch(e); }, {passive: false});
</script>
</body>
</html>